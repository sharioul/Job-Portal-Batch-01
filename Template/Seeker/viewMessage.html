{% extends 'Common/base.html' %}

{% block title %}Messages | Job Portal{% endblock %}

{% block body %}
<div class="container mt-4">
    <div class="card" style="max-width: 800px; margin: 0 auto;">
        <h2 class="text-center mb-4">
            Messages for {{ application.job.job_title }}
            <br>
            <small style="font-size: 1rem; color: var(--text-secondary);">{{ application.job.company_name }}</small>
        </h2>

        <div
            style="border: 1px solid var(--border-color); border-radius: var(--radius-md); height: 400px; overflow-y: auto; padding: 1rem; background-color: #f9f9f9; display: flex; flex-direction: column-reverse;">
            {% if messages %}
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                {% for message in messages %}
                <div style="max-width: 80%; padding: 0.75rem; border-radius: 1rem; position: relative;
                            {% if message.sender == request.user %}
                                align-self: flex-end; background-color: var(--primary-color); color: white; border-bottom-right-radius: 0.25rem;
                            {% else %}
                                align-self: flex-start; background-color: white; border: 1px solid var(--border-color); border-bottom-left-radius: 0.25rem;
                            {% endif %}
                        ">
                    <strong style="display: block; font-size: 0.8em; margin-bottom: 0.25rem; opacity: 0.9;">{{
                        message.sender.username }}</strong>
                    {{ message.content }}
                    <small
                        style="display: block; font-size: 0.7em; margin-top: 0.5rem; opacity: 0.8; text-align: right;">{{
                        message.timestamp|date:"M d, H:i" }}</small>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center" style="margin-top: auto; margin-bottom: auto; color: var(--text-secondary);">
                No messages yet.
            </div>
            {% endif %}
        </div>

        <div class="mt-4 text-center">
            <a href="{% url 'appliedJob' %}" class="btn btn-secondary">Back to Applied Jobs</a>
        </div>
    </div>
</div>
{% endblock %}